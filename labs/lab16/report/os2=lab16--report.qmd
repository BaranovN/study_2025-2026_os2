---
# Preamble

## Author
author:
  name: Баранов Никита Дмитриевич
## Title
title: "Отчёт о лабораторной работе"
subtitle: "Лабораторная работа 16. Программный RAID"
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Освоить работу с RAID-массивами при помощи утилиты mdadm

# Задание

1. Прочитайте руководство по работе с утилитами fdisk, sfdisk и mdadm.
2. Добавить три диска на виртуальную машину (объёмом от 512 MiB каждый). При помощи sfdisk создать на каждом из дисков по одной партиции, задав тип раздела для
RAID (см. разделы 16.4.1, 16.4.2)
3. Создать массив RAID 1 из двух дисков, смонтировать его. Эмитировать сбой одного из
дисков массива, удалить искусственно выведенный из строя диск, добавить в массив
работающий диск (см. раздел 16.4.2).
4. Создать массив RAID 1 из двух дисков, смонтировать его. Добавить к массиву третий диск. Эмитировать сбой одного из дисков массива. Проанализировать состояние
массива, указать различия по сравнению с предыдущим случаем (см. раздел 16.4.3).
5. Создать массив RAID 1 из двух дисков, смонтировать его. Добавить к массиву третий
диск. Изменить тип массива с RAID1 на RAID5, изменить число дисков в массиве с 2 на 3.
Проанализировать состояние массива, указать различия по сравнению с предыдущим
случаем (см. раздел 16.4.4).

# Выполнение лабораторной работы

## Подготовка дисков для RAID

Проверяем наличие дисков в системе (рис. [-@fig:001]).

![Проверка дисков в системе](image/1.png){#fig:001 width=70%}

Создаем разделы на каждом из дисков (рис. [-@fig:001], [-@fig:002]).

![Создание разделов на дисках](image/2.png){#fig:002 width=70%}

Проверяем тип созданных разделов (рис. [-@fig:002]).

**Тип разделов:** 83 (Linux)

Меняем тип разделов на Linux raid autodetect (fd) (рис. [-@fig:003]).

![Изменение типа разделов на RAID](image/3.png){#fig:003 width=70%}

Проверяем состояние дисков после изменения типа разделов (рис. [-@fig:003]).

**Состояние дисков:** все разделы имеют тип fd (Linux raid autodetect)

## Создание RAID-массива уровня 1

Создаем RAID 1 массив из двух дисков (рис. [-@fig:004]).

![Создание RAID 1 массива](image/4.png){#fig:004 width=70%}

Проверяем состояние массива (рис. [-@fig:004]).

**Состояние массива:** активен, оба устройства в состоянии [UU], синхронизация завершена

Создаем файловую систему и настраиваем монтирование (рис. [-@fig:005], [-@fig:006]).

![Создание файловой системы и монтирование](image/5.png){#fig:005 width=70%}
![Настройка /etc/fstab](image/6.png){#fig:006 width=70%}

## Имитация сбоя и замена диска

Имитируем сбой диска и выполняем замену (рис. [-@fig:007]).

![Имитация сбоя и замена диска](image/7.png){#fig:007 width=70%}

**Состояние массива после замены:** массив восстановлен с новым диском, оба устройства в состоянии [UU]

## RAID-массив с горячим резервом

Создаем RAID 1 массив с горячим резервом (рис. [-@fig:008]).

![RAID массив с горячим резервом](image/8.png){#fig:008 width=70%}

**Состояние массива:** 2 активных устройства, 1 запасное, состояние clean

Имитируем сбой диска и проверяем автоматическое восстановление (рис. [-@fig:009]).

![Автоматическое восстановление массива](image/9.png){#fig:009 width=70%}

**Состояние массива после сбоя:** массив автоматически перестроился с использованием запасного диска

## Преобразование RAID 1 в RAID 5

Создаем новый массив и преобразуем его в RAID 5 (рис. [-@fig:010], [-@fig:011], [-@fig:012]).

![Преобразование в RAID 5](image/10.png){#fig:010 width=70%}
![Изменение уровня RAID](image/11.png){#fig:011 width=70%}
![Изменение количества дисков в RAID 5](image/12.png){#fig:012 width=70%}

**Состояние массива после преобразования:** массив преобразован в RAID 5, выполняется изменение размера (25% complete)

Завершаем работу с массивами (рис. [-@fig:013]).

![Завершение работы с RAID](image/13.png){#fig:013 width=70%}

# Выводы

Мы освоили работу с RAID-массивами при помощи утилиты mdadm

# Список литературы{.unnumbered}

::: {#refs}
:::
